 /*       SIST ENDRET 26/04-96 12.09.39 AV   JDA0310                  */00000000
 /*       SIST ENDRET 12/10-95 14.04.01 AV   JDA0310                  */00000010
 /*       SIST ENDRET 20/01-94 12.33.41 AV   DYBVIK                   */00000020
 /*       SIST ENDRET 20/01-94 12.23.44 AV   DYBVIK                   */00000030
 /*       SIST ENDRET 26/04-91 11.42.26 AV   DYBVIK                   */00000040
 /*       SIST ENDRET 14/04-89 13.25.53 AV   HERMAN                   */00000050
 /*       SIST ENDRET 02/04-85 13.11.05 AV   LUNDEBY                  */00000060
 /*       SIST ENDRET 17/01-85 07.27.43 AV   LUNDEBY                  */00000070
 /*       SIST ENDRET 24/10-84 09.51.39 AV   FARVIK                   */00000080
 /*       SIST ENDRET 12/09-83 09.14.48 AV   KARIN                    */00000090
 /*       SIST ENDRET 24/05-83 10.07.37 AV   FARVIK                   */00000100
 /*       SIST ENDRET 05/05-83 11.40.57 AV   JANKR                    */00000110
                                                                        00000120
 /******************************************************************* */00000130
 /*IDENTIFIKASJON:                                                    */00000140
 /************************                                            */00000150
 /*  PROGRAM-IDENT : R0010452 - FJERN ALLE TRANSER - SUB-PROGRAM      */00000160
 /*  PROGRAM-SPRÅK : PLI                                              */00000170
 /*  PROGRAMMERER  : JAN HARALD KRISTENSEN                            */00000180
 /*  PROGRAMMET BLE LAGET  :                                          */00000190
 /*  ENDRINGERSDATO :                                                 */00000200
 /*  ENDRINGEN GJELDER:                                               */00000210
 /*  ENDRINGEN BLE UTFØRT AV :                                        */00000220
 /******************************************************************* */00000230
 /*HENSIKT:                                                           */00000240
 /************                                                        */00000250
 /*  SUB-PROGRAM I DELSYSTEMET FJERNING.                              */00000260
 /*    FJERNER ALLE TRANSER FRA TRANSAKSJONSHISTORIKKEN               */00000270
 /*  FORBEREDE_TRANS:                                                 */00000280
 /*    RUTINEN LESER FØRSTE TRANS I TRANSHISTORIKKEN                  */00000290
 /*  HENT_TRANS:                                                      */00000300
 /*    RUTINEN LESER ALLE TRANSER I TRANSHISTORIKKEN OG LEGGER        */00000310
 /*    DEM  I EN TRANS_LISTE                                          */00000320
 /*  MAPS_UT_AT:                                                      */00000330
 /*    RUTINEN SKRIVER EN OG EN TRANS UT PÅ SKJERMEN                  */00000340
 /*  FJERN_ALLE_TRANS:                                                */00000350
 /*    RUTINEN FJERNER SISTE OG NEST-SISTE STATUS SAMT ALLE TRANSER   */00000360
 /*    CALLER STATISTIKK-RUTINEN OG SKRIVER UT TRANSENE               */00000370
 /*  BEHANDLE_FNR:                                                    */00000380
 /*    RUTINEN SETTER INN FØDSELSNUMMER I FNR_ARRAY SOM IKKE FINNES   */00000390
 /*    FRA FØR                                                        */00000400
 /*                                                                   */00000410
 /*PROGRAMTILKNYTTING:                                                */00000420
 /**********************                                              */00000430
 /*  PROGRAMMET BLIR CALLET OPP AV R0010450.                          */00000440
 /*  ***************************************                          */00000450
 /*  PROCEDUREN FORBEREDE_TRANS:                                      */00000460
 /*    R0015201 LINKES FOR Å LESE TRANSEN                             */00000470
 /*  PROCEDUREN HENT_TRANS:                                           */00000480
 /*    R0010411 LINKES FOR Å BYGGE OPP TRANS_LISTE OG FNR_ARRAY       */00000490
 /*    R0015201 LINKES FOR Å LESE EN TRANS                            */00000500
 /*  PROCEDUREN FJERN_ALLE_TRANS:                                     */00000510
 /*    R0015401 LINKES FOR Å FJERNE SISTE OG NEST SISTE STATUS        */00000520
 /*    R0015501 LINKES FOR Å FJERNE ALLE TRANSER                      */00000530
 /*    CALLER BEHANDLE_FNR (SUB-PROGRAM)                              */00000540
 /*    R0016201 LINKES FOR Å GENERERE STATISTIKK                      */00000550
 /*    R0016401 LINKES FOR Å GENERERE STATISTIKK                      */00000560
 /*    R0010412 LINKES FOR Å LISTE UT FJERNEDE TRANSER                */00000570
 /******************************************************************* */00000580
 /*                                                                   */00000590
 /*DATASETTOPPLYSNINGER:                                              */00000600
 /*************************                                           */00000610
 /*  PO/PE-BASEN:                                                     */00000620
 /*               EN OG EN TRANS LESES (R0015201)                     */00000630
 /*               FJERNE SISTE OG NEST-SISTE STATUS (R0015401)        */00000640
 /*               FJERNE ALLE TRANSER               (R0015501)        */00000650
 /*  STATISTIKK_BASEN:                                                */00000660
 /*               BRUKES I R0016201                                   */00000670
 /*    ER DETTE NØDVENDIG????                                         */00000680
 /*  **DDNAVN,TYPE I/O DATASETTOPPLYSNINGER,PSB-NAVN **               */00000690
 /*                                                                   */00000700
 /*FEILMELDINGER:                                                     */00000710
 /*********************                                               */00000720
 /*  'PERSONEN MED FØDSELSNUMMER NNNNNNNNNNN ER IKKE I DATABASEN'     */00000730
 /*  'DET FINNES INGEN TRANSAKSJONER TIL PERSONEN MED FNR:NNNNNNNNN'  */00000740
 /*                                                                   */00000750
 /* ***************************************************************** */00000760
                                                                        00000770
 FORBEREDE_TRANS:                                                       00000780
   PROC;                                                                00000790
                                                                        00000800
     DIV_PARAM_OMR.POS_I_B01    = 1;     /* BARE INITIERT FOR 5201 */   00000810
     DIV_PARAM_OMR.SØKER_IND    = 1;     /* BARE INITIERT FOR 5201 */   00000820
     DIV_PARAM_OMR.FEIL_MELD_NR = 0;                                    00000830
     DIV_PARAM_OMR.TRANS_VIRKDATO_ÅM     = 0;                           00000840
     DIV_PARAM_OMR.FØRSTE_CALL_LES_TRANS = '1'B;                        00000850
                                                                        00000860
     PIC_11 = DIV_PARAM_OMR.SEARCH_FNR;                                 00000870
                                                                        00000880
     TRANS_OPPL_OMR.VIRKNINGSDATO  = 0;                                 00000890
     TRANS_OPPL_OMR.FØDSNUMMER     = 0;                                 00000900
                                                                        00000910
     /*******    LES TRANS        *********/                            00000920
     EXEC CICS LINK PROGRAM ('R0015201') COMMAREA(KOM_OMR);             00000930
                                                                        00000940
     IF DIV_PARAM_OMR.FEIL_MELD_NR > 0 THEN                             00000950
        FATAL_FEIL = '1'B;                                              00000960
                                                                        00000970
     ELSE IF TRANS_OPPL_OMR.FØDSNUMMER = 0 THEN                         00000980
        MAP_MELDING = 'PERSONEN MED FØDSELSNUMMER: ' !! PIC_11 !!       00000990
                      ' ER IKKE I DATABASEN';                           00001000
                                                                        00001010
      ELSE IF TRANS_OPPL_OMR.VIRKNINGSDATO = 0 THEN                     00001020
         MAP_MELDING = 'DET FINNES INGEN TRANSAKSJONER TIL ' !!         00001030
                       'PERSONEN MED FNR: ' !! PIC_11;                  00001040
                                                                        00001050
     IF DIV_PARAM_OMR.FEIL_MELD_NR   > 0 !                              00001060
        TRANS_OPPL_OMR.FØDSNUMMER    = 0 !                              00001070
        TRANS_OPPL_OMR.VIRKNINGSDATO = 0 THEN                           00001080
                                                                        00001090
           FEIL = '1'B;                                                 00001100
                                                                        00001110
                                                                        00001120
 END FORBEREDE_TRANS;                                                   00001130
                                                                        00001140
                                                                        00001150
 HENT_TRANS:                                                            00001160
   PROC;                                                                00001170
                                                                        00001180
    DCL                                                                 00001190
        STOPP                    BIT(1) INIT('0'B);                     00001200
                                                                        00001210
                                                                        00001220
    DIV_PARAM_OMR.FØRSTE_CALL_LES_TRANS = '0'B;                         00001230
                                                                        00001240
    DO WHILE (^STOPP);                                                  00001250
                                                                        00001260
       /*----------------------------------------------------------*/   00001270
       /*   BYGGE OPP TRANS_LISTE OG FNR_ARRAY                     */   00001280
       /*----------------------------------------------------------*/   00001290
                                                                        00001300
       IF ^DIV_PARAM_OMR.FØRSTE_CALL_LES_TRANS  THEN                    00001310
          EXEC CICS LINK PROGRAM('R0010411') COMMAREA (LOKAL_KOM_OMR);  00001320
                                                                        00001330
    /* IF FNR_ARRAY_ANT > 14 THEN SATISH  20.1.94 FOR TEST  */          00001340
       IF FNR_ARRAY_ANT > 26 THEN                                       00001350
          DO;                                                           00001360
             DIV_PARAM_OMR.FEIL_MELD_NR = 214;                          00001370
             DIV_PARAM_OMR.PROGRAM_ID   = 'R0010452';                   00001380
             FATAL_FEIL = '1'B;                                         00001390
             GOTO SLUTT;                                                00001400
          END;                                                          00001410
                                                                        00001420
       KOM_OMR.TRANS_OPPL_PEKER = ADDR(KOM_OMR.TRANS_OPPL_OMR);         00001430
                                                                        00001440
       /*----------------------------------------------------------*/   00001450
       /* LES TRANS                                                */   00001460
       /*----------------------------------------------------------*/   00001470
                                                                        00001480
       EXEC CICS LINK PROGRAM ('R0015201') COMMAREA(KOM_OMR);           00001490
                                                                        00001500
       IF DIV_PARAM_OMR.FEIL_MELD_NR > 0 THEN                           00001510
          DO;                                                           00001520
             FATAL_FEIL = '1'B;                                         00001530
             GOTO SLUTT;                                                00001540
          END;                                                          00001550
                                                                        00001560
       IF TRANS_ANT = 27 THEN                     /* BEGRENSNING I    */00001570
          TRANS_OPPL_OMR.VIRKNINGSDATO = 0;       /* TRANS - ANTALLET */00001580
                                                                        00001590
       IF TRANS_OPPL_OMR.VIRKNINGSDATO > 0 THEN                         00001600
          DO;                                                           00001610
             TRANS_ANT = TRANS_ANT + 1;                                 00001620
             DIV_PARAM_OMR.FØRSTE_CALL_LES_TRANS = '0'B;                00001630
          END;                                                          00001640
       ELSE IF FNR_ARRAY(FNR_ARRAY_IND + 1) > 0 THEN                    00001650
          DO;                                                           00001660
             FNR_ARRAY_IND = FNR_ARRAY_IND + 1;                         00001670
             SEARCH_FNR    = FNR_ARRAY(FNR_ARRAY_IND);                  00001680
             DIV_PARAM_OMR.FØRSTE_CALL_LES_TRANS = '1'B;                00001690
          END;                                                          00001700
       ELSE IF TRANS_OPPL_OMR.BLANKETTYPE   = 'O1'    &                 00001710
               TRANS_ANT                    =   1       THEN            00001720
          DO;                                                           00001730
             /*-------------------------------------------------------*/00001740
             /* HVIS INNLEST TRANS ER EN DØDSTRANS OG BARE 1 TRANS ER */00001750
             /* FINNES, SJEKKES TILKN FOR Å FINNE ETTERLATTE-TRANSEN. */00001760
             /*-------------------------------------------------------*/00001770
                                                                        00001780
                                                                        00001790
             SEARCH_FNR                  =  0                        ;  00001800
             DIV_PARAM_OMR.ØNSKET_STATUS = 'S'                       ;  00001810
             DIV_PARAM_OMR.POS_I_B01     =  1                        ;  00001820
             DIV_PARAM_OMR.SEARCH_FNR    =  TRANS_OPPL_OMR.FØDSNUMMER;  00001830
                                                                        00001840
             EXEC CICS LINK PROGRAM    ('R0013110') COMMAREA(KOM_OMR);  00001850
                                                                        00001860
             IF DIV_PARAM_OMR.FEIL_MELD_NR  >  0              THEN      00001870
                DO;                                                     00001880
                   FATAL_FEIL               = '1'B;                     00001890
                   GOTO SLUTT;                                          00001900
                END;                                                    00001910
                                                                        00001920
                                                                        00001930
             DO I = 1 TO 13 WHILE (B01.PERSON(1).FNR_TILKN (I) > 0 );   00001940
                                                                        00001950
                IF B01.PERSON(1).TILKNYTNINGSKODE(I)  = 'E' !           00001960
                   B01.PERSON(1).TILKNYTNINGSKODE(I)  = 'N' !           00001970
                   B01.PERSON(1).TILKNYTNINGSKODE(I)  = 'B' THEN        00001980
                   DO;                                                  00001990
                      SEARCH_FNR    =  B01.PERSON(1).TILKN.FNR_TILKN(I);00002000
                      I             =  13;                              00002010
                   END;                                                 00002020
             END;                                                       00002030
                                                                        00002040
             IF SEARCH_FNR          >  0                      THEN      00002050
                DO;                                                     00002060
                   FNR_ARRAY_IND    =  FNR_ARRAY_IND     +   1  ;       00002070
                   DIV_PARAM_OMR.FØRSTE_CALL_LES_TRANS   =  '1'B;       00002080
                END;                                                    00002090
             ELSE                                                       00002100
                DO;                                                     00002110
                  ANTALL_TRANS_I_TRANS_LISTE  =  TRANS_ANT;             00002120
                  STOPP                       =  '1'B;                  00002130
                END;                                                    00002140
                                                                        00002150
             B01.PERSON(1)                    =  '';                    00002160
                                                                        00002170
          END;                                                          00002180
       ELSE                                                             00002190
          DO;                                                           00002200
             ANTALL_TRANS_I_TRANS_LISTE       =  TRANS_ANT;             00002210
             STOPP                            =  '1'B;                  00002220
          END;                                                          00002230
                                                                        00002240
    END;                                                                00002250
                                                                        00002260
                                                                        00002270
 SLUTT:                                                                 00002280
                                                                        00002290
 END HENT_TRANS;                                                        00002300
                                                                        00002310
                                                                        00002320
  /* **************************************************************** */00002330
  /*  PROCEDURE FOR Å SKRIVE TRANSER TIL SKJERMEN                     */00002340
  /* **************************************************************** */00002350
                                                                        00002360
  MAPS_UT_AT:                                                           00002370
     PROC;                                                              00002380
                                                                        00002390
     DCL  I               FIXED BIN(15);                                00002400
                                                                        00002410
     CALL LOW_VALUES_TIL_MAP;                                           00002420
                                                                        00002430
     /**** HER SKAL TRANSENE UT    *****/                               00002440
                                                                        00002450
     EXEC CICS SEND MAP('S0010E3') MAPSET('S0010E3') ACCUM PAGING ERASE;00002460
                                                                        00002470
     DO I = ANTALL_TRANS_I_TRANS_LISTE TO 1 BY -1;                      00002480
        CALL LOW_VALUES_TIL_MAP;                                        00002490
        KOM_OMR.TRANS_OPPL_PEKER = TRANS_LISTE.TRANS_OPPL_PTR(I);       00002500
        S0010E4O.VIRK_DATO_MÅO   = TRANS_OPPL_OMR.VIRKNINGSDATO;        00002510
        S0010E4O.BL_TYPEO        = TRANS_OPPL_OMR.BLANKETTYPE;          00002520
                                                                        00002530
        /* PLUKKER UT DEN DØDE    */                                    00002540
                                                                        00002550
        IF TRANS_OPPL_OMR.BLANKETTYPE = 'O1' THEN                       00002560
           FNR_DØD               = TRANS_OPPL_OMR.FØDSNUMMER;           00002570
                                                                        00002580
        IF VERIFY('0123456789',TRANS_LISTE.FNR_EK(I)) = 0 THEN          00002590
           IF TRANS_LISTE.FNR_EK(I) > 0 THEN                            00002600
              S0010E4O.FNR_EKTEFO   = TRANS_LISTE.FNR_EK(I);            00002610
        S0010E4O.ANT_BARNO       = TRANS_LISTE.ANT_BARN(I);             00002620
        EXEC CICS SEND MAP('S0010E4') MAPSET('S0010E3') ACCUM PAGING;   00002630
                                                                        00002640
     END;                                                               00002650
                                                                        00002660
     CALL LOW_VALUES_TIL_MAP;                                           00002670
                                                                        00002680
     /*****      TRAILER       *****/                                   00002690
                                                                        00002700
     S0010E6O.MELDINGO = 'VENNLIGST IKKE LA DETTE BILDET STÅ LENGE DA'!!00002710
                         ' DET OPPTAR STORE MASKIN-RESSURSER.';         00002720
     EXEC CICS SEND MAP('S0010E6') MAPSET('S0010E3') ACCUM PAGING;      00002730
     EXEC CICS SEND PAGE RETAIN NOAUTOPAGE;                             00002740
                                                                        00002750
  END MAPS_UT_AT;                                                       00002760
                                                                        00002770
                                                                        00002780
                                                                        00002790
  /* **************************************************************** */00002800
  /*  PROCEDURE FOR Å FJERNE ALLE STATUS OG TRANSER.                  */00002810
  /* **************************************************************** */00002820
                                                                        00002830
  FJERN_ALLE_TRANS:                                                     00002840
     PROC;                                                              00002850
                                                                        00002860
     /*-------------------------------------------------------------*/  00002870
     /* MÅ FINNE ALLE TILKNYTTNINGER TIL FORSØRGEDE PERSONER        */  00002880
     /*-------------------------------------------------------------*/  00002890
                                                                        00002900
     DCL 01 W01_FNR_ARRAY(13),                                          00002910
            05 W01_FNR_TILKN    DEC FIXED(11);                          00002920
                                                                        00002930
     DIV_PARAM_OMR.ØNSKET_STATUS =  'S'                           ;     00002940
     DIV_PARAM_OMR.POS_I_B01     =  1                             ;     00002950
     DIV_PARAM_OMR.SEARCH_FNR    =  TRANS_OPPL_OMR.FØDSNUMMER     ;     00002960
                                                                        00002970
     EXEC CICS LINK PROGRAM    ('R0013110') COMMAREA(KOM_OMR)     ;     00002980
                                                                        00002990
     IF DIV_PARAM_OMR.FEIL_MELD_NR  >  0              THEN              00003000
        DO;                                                             00003010
           FATAL_FEIL               = '1'B;                             00003020
           GOTO SLUTT;                                                  00003030
        END;                                                            00003040
                                                                        00003050
     W01_FNR_ARRAY = '';                                                00003060
                                                                        00003070
                                                                        00003080
     DO I = 1 TO 13;                                                    00003090
        IF  B01.PERSON(1).TILKNYTNINGSKODE(I) = 'F' !                   00003100
            B01.PERSON(1).TILKNYTNINGSKODE(I) = 'L' !                   00003110
            B01.PERSON(1).TILKNYTNINGSKODE(I) = 'V' !    /*HL*/         00003120
            B01.PERSON(1).TILKNYTNINGSKODE(I) = 'W' THEN                00003130
                                                                        00003140
            W01_FNR_TILKN(I) = B01.PERSON(1).TILKN.FNR_TILKN(I);        00003150
     END;                                                               00003160
                                                                        00003170
     /*-------------------------------------------------------------*/  00003180
     /* LESER INN ALLE PERSONER MED 3110 P.GR.A TKNR TIL NORTRYGD   */  00003190
     /*-------------------------------------------------------------*/  00003200
                                                                        00003210
     DO I = 1 TO 14  WHILE (FNR_ARRAY (I) > 0)                       ;  00003220
                                                                        00003230
        DIV_PARAM_OMR.POS_I_B01  =  I                                ;  00003240
        DIV_PARAM_OMR.SEARCH_FNR =  FNR_ARRAY (I)                    ;  00003250
        EXEC CICS LINK PROGRAM    ('R0013110') COMMAREA(KOM_OMR)     ;  00003260
                                                                        00003270
        /*----------------------------------------------------------*/  00003280
        /* VED GJENNTAGENDE FORSØK PÅ FJERNING KAN EN PERSON MISTE  */  00003290
        /* SISTE STATUS . IGNORERER FEILMELDINGEN SOM VARSLER DET . */  00003300
        /*----------------------------------------------------------*/  00003310
                                                                        00003320
        IF DIV_PARAM_OMR.FEIL_MELD_NR     =  495            THEN        00003330
           DIV_PARAM_OMR.FEIL_MELD_NR     =  0;                         00003340
        ELSE                                                            00003350
           IF DIV_PARAM_OMR.FEIL_MELD_NR  >  0              THEN        00003360
              DO;                                                       00003370
                FATAL_FEIL                = '1'B;                       00003380
                GOTO SLUTT;                                             00003390
              END;                                                      00003400
                                                                        00003410
        IF B01.TKNR (I)          >  0                             THEN  00003420
           DO;                                                          00003430
              CALL P900_NOR_DATA (B01.FNR (I) , B01.TKNR (I) )       ;  00003440
                                                                        00003450
              IF DIV_PARAM_OMR.FEIL_MELD_NR >  0                  THEN  00003460
                 DO;                                                    00003470
                   FATAL_FEIL               = '1'B;                     00003480
                   GOTO SLUTT;                                          00003490
                 END;                                                   00003500
           END;                                                         00003510
                                                                        00003520
     END;                                                               00003530
                                                                        00003540
     /*-------------------------------------------------------------*/  00003550
     /* FJERNING AV SISTE OG NEST SISTE STATUS.                     */  00003560
     /*-------------------------------------------------------------*/  00003570
                                                                        00003580
     B00                    = ''  ;                                     00003590
     B01                    = B00 ;                                     00003600
     B02                    = B00 ;                                     00003610
                                                                        00003620
     DO I = 1 TO 14;                                                    00003630
        B00.RF0PERSN.FNR(I) = FNR_ARRAY(I);                             00003640
        B02.RF0PERSN.FNR(I) = FNR_ARRAY(I);                             00003650
     END;                                                               00003660
                                                                        00003670
     EXEC CICS LINK PROGRAM ('R0015401') COMMAREA(KOM_OMR);             00003680
                                                                        00003690
     IF DIV_PARAM_OMR.FEIL_MELD_NR > 0 THEN                             00003700
        DO;                                                             00003710
           FATAL_FEIL = '1'B;                                           00003720
           GOTO SLUTT;                                                  00003730
        END;                                                            00003740
                                                                        00003750
                                                                        00003760
     /*-------------------------------------------------------------*/  00003770
     /* FJERNING AV TRANSER                                         */  00003780
     /*-------------------------------------------------------------*/  00003790
                                                                        00003800
     FJERN_ALLE = '1'B;         /* INDIKERER FJERNING AV ALLE       */  00003810
                                                                        00003820
     DO I = 1 TO FNR_ARRAY_ANT;                                         00003830
                                                                        00003840
        SEARCH_FNR = FNR_ARRAY(I);                                      00003850
                                                                        00003860
        IF ^ (FNR_DØD = FNR_ARRAY(I) & I > 1) THEN                      00003870
           DO;                                                          00003880
                                                                        00003890
           IF SUBSTR(DIV_PARAM_OMR.CICS_NAVN,1,4) = 'HELP'  THEN        00003900
                   EXEC CICS LINK PROGRAM ('R0015502')                  00003910
                                  COMMAREA(LOKAL_KOM_OMR);              00003920
                                                                        00003930
           ELSE                                                         00003940
                                                                        00003950
                   EXEC CICS LINK PROGRAM ('R0015501')                  00003960
                                  COMMAREA(LOKAL_KOM_OMR);              00003970
                                                                        00003980
           END;                                                         00003990
                                                                        00004000
        IF DIV_PARAM_OMR.FEIL_MELD_NR > 0 THEN                          00004010
           DO;                                                          00004020
              FATAL_FEIL = '1'B;                                        00004030
              GOTO SLUTT;                                               00004040
           END;                                                         00004050
     END;                                                               00004060
                                                                        00004070
                                                                        00004080
     /*---------------------------------------------------------------*/00004090
     /* SETTER NÅ INN I FNR_ARRAY FØDSELSNUMMER TIL DE SOM HAR TRANSER*/00004100
     /*---------------------------------------------------------------*/00004110
                                                                        00004120
     FNR_ARRAY     = 0;                                                 00004130
     FNR_ARRAY_ANT = 0;                                                 00004140
                                                                        00004150
     DO I = 1 TO ANTALL_TRANS_I_TRANS_LISTE;                            00004160
        KOM_OMR.TRANS_OPPL_PEKER = TRANS_LISTE.TRANS_OPPL_PTR (I)     ; 00004170
        CALL BEHANDLE_FNR;                                              00004180
     END;                                                               00004190
                                                                        00004200
     KOM_OMR.TRANS_OPPL_PEKER = ADDR(KOM_OMR.TRANS_OPPL_OMR)          ; 00004210
                                                                        00004220
     DO I = 1 TO FNR_ARRAY_ANT;                                         00004230
                                                                        00004240
        /*----------------------------------------------------------*/  00004250
        /* KALLER OPP STATISTIKK VED FJERNING AV ALLE               */  00004260
        /*----------------------------------------------------------*/  00004270
                                                                        00004280
        TRANS_OPPL_OMR.FØDSNUMMER = FNR_ARRAY(I);                       00004290
                                                                        00004300
        EXEC CICS LINK PROGRAM ('R0016401') COMMAREA(KOM_OMR);          00004310
                                                                        00004320
        IF DIV_PARAM_OMR.FEIL_MELD_NR > 0 THEN                          00004330
           DO;                                                          00004340
              FATAL_FEIL = '1'B;                                        00004350
              GOTO SLUTT;                                               00004360
           END;                                                         00004370
                                                                        00004380
        EXEC CICS LINK PROGRAM ('R0016201') COMMAREA(KOM_OMR);          00004390
                                                                        00004400
        IF DIV_PARAM_OMR.FEIL_MELD_NR > 0 THEN                          00004410
           DO;                                                          00004420
              FATAL_FEIL = '1'B;                                        00004430
              GOTO SLUTT;                                               00004440
           END;                                                         00004450
     END;                                                               00004460
                                                                        00004470
     DO I = 1  TO 13;                                                   00004480
        IF W01_FNR_TILKN(I) > 0 THEN                                    00004490
           DO;                                                          00004500
              TRANS_OPPL_OMR.FØDSNUMMER = W01_FNR_TILKN(I);             00004510
                                                                        00004520
              EXEC CICS LINK PROGRAM ('R0016401') COMMAREA(KOM_OMR);    00004530
                                                                        00004540
              IF DIV_PARAM_OMR.FEIL_MELD_NR > 0 THEN                    00004550
                 DO;                                                    00004560
                    FATAL_FEIL = '1'B;                                  00004570
                    GOTO SLUTT;                                         00004580
                 END;                                                   00004590
                                                                        00004600
              EXEC CICS LINK PROGRAM ('R0016201') COMMAREA(KOM_OMR);    00004610
                                                                        00004620
              IF DIV_PARAM_OMR.FEIL_MELD_NR > 0 THEN                    00004630
                 DO;                                                    00004640
                    FATAL_FEIL = '1'B;                                  00004650
                    GOTO SLUTT;                                         00004660
                 END;                                                   00004670
           END;                                                         00004680
     END;                                                               00004690
                                                                        00004700
     /*-------------------------------------------------------------*/  00004710
     /* UTLISTING AV FJERNEDE TRANSER                               */  00004720
     /*-------------------------------------------------------------*/  00004730
                                                                        00004740
     EXEC CICS LINK PROGRAM ('R0010412') COMMAREA(LOKAL_KOM_OMR);       00004750
                                                                        00004760
  SLUTT:                                                                00004770
                                                                        00004780
      IF DIV_PARAM_OMR.FEIL_MELD_NR = 0 &                               00004790
         FATAL_FEIL = '0'B         THEN                                 00004800
            CALL SKRIV_BRUKER_ID;                                       00004810
                                                                        00004820
  END FJERN_ALLE_TRANS;                                                 00004830
                                                                        00004840
                                                                        00004850
                                                                        00004860
 /* **************************************************************** */ 00004870
 /*    SETTER INN FØDSELSNUMMER I FNR_ARRAY SOM IKKE FINNES FRA FØR  */ 00004880
 /* **************************************************************** */ 00004890
                                                                        00004900
 BEHANDLE_FNR:                                                          00004910
    PROC;                                                               00004920
                                                                        00004930
    DO K = 1 TO 27;                                                     00004940
       IF TRANS_OPPL_OMR.FØDSNUMMER = FNR_ARRAY(K) THEN                 00004950
          K = 27;                                                       00004960
       ELSE IF FNR_ARRAY(K) = 0 THEN                                    00004970
          DO;                                                           00004980
             FNR_ARRAY(K)  = TRANS_OPPL_OMR.FØDSNUMMER;                 00004990
             FNR_ARRAY_ANT = FNR_ARRAY_ANT + 1;                         00005000
             K = 27;                                                    00005010
          END;                                                          00005020
    END;                                                                00005030
                                                                        00005040
 END BEHANDLE_FNR;                                                      00005050
