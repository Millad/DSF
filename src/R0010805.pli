 /*   SIST ENDRET PÅ PROD   2002.10.30  8.56.02 AV   JDA2970          */        
 /*       SIST ENDRET 22/06-98 10.23.06 AV   JDA7339                  */        
 /*       SIST ENDRET 04/06-98 15.18.49 AV   RFA9991                  */        
 /* ***************************************************************** */        
 /*IDENTIFIKASJON:                                                    */        
 /*    R0010805 PLI          PER F. BERGESTAD                         */        
 /*    PROGRAMMET ER LAGET I AUGUST 1981.                             */        
 /*HENSIKT:                                                           */        
 /*    KONTROLLERE SPES.INFO DELEN PÅ GRUNNBLANKETTT ETTERLATT EK.    */        
 /*BRUKES:                                                            */        
 /*    CALL KONTROLL_EP_SPES(FEIL_I_EP_SPES);                         */        
 /*PARAMETRE INN:                                                     */        
 /*    INGEN, MEN BRUKER EPSP DATAENE I EP_TRANS_OMR.                 */        
 /*PARAMETRE UT :                                                     */        
 /*    FEIL_FUNNET                                                    */        
 /* ***************************************************************** */        
  KONTROLL_EP_SPES:                                                             
    PROC(FEIL_FUNNET);                                                          
 %SKIP(2);                                                                      
   DCL                                                                          
      FEIL_FUNNET                        BIT(1);                                
   DCL                                                                          
      T_FNR                              PIC'(11)9';                            
   DCL                                                                          
      T_FNR13                            PIC'(13)9';                            
   DCL                                                                          
      KEY_BIT1                   BIT(32) BASED (KEY_PEKER1),                    
      KEY_BIT2                   BIT(32) BASED (KEY_PEKER2),                    
      KEY_PEKER1                 POINTER,                                       
      KEY_PEKER2                 POINTER,                                       
      ST_RECL                    CHAR (35);                                     
   DCL                                                                          
      1 FNR            DEF T_FNR,                                               
         2 DG          PIC'99',                                                 
         2 MN          PIC'99',                                                 
         2 ÅR          PIC'99',                                                 
         2 PERSNR,                                                              
            3 ÅRHUNDRE PIC'999',                                                
            3 REST     PIC'99';                                                 
   DCL                                                                          
      1 FNR13          DEF T_FNR13,                                             
         2 DG          PIC'99',                                                 
         2 MN          PIC'99',                                                 
         2 ÅR          PIC'9999',                                               
         2 PERSNR,                                                              
            3 ÅRHUNDRE PIC'999',                                                
            3 REST     PIC'99';                                                 
 %PAGE;                                                                         
   DCL                                                                          
      FYLT_SEKSTISJU                     PIC'(6)9' INIT(0),                     
      SEKSTI_ÅR    POS(1) DEF FYLT_SEKSTISJU  PIC'(4)9',                        
      SEKSTI_MND   POS(5) DEF FYLT_SEKSTISJU  PIC'(2)9',                        
      FYLT_SYTTI                         PIC'(6)9' INIT(0),                     
      SYTTI_ÅR     POS(1) DEF FYLT_SYTTI      PIC'(4)9',                        
      SYTTI_MND    POS(5) DEF FYLT_SYTTI      PIC'(2)9';                        
   DCL                                                                          
      TT                                 PIC'999' INIT(0),                      
      MAKS_TT_ETTER_DØD                  PIC'(4)9' INIT(0),                     
      TT_FRAMT_10_1_MND                  PIC'(3)9' INIT(0);                     
   DCL                                                                          
      T_DØD_EK_ÅMD                       PIC'(8)9' INIT(0),                     
      DØD_Å     DEF T_DØD_EK_ÅMD POS(1)  PIC '(4)9',                            
      DØD_M     DEF T_DØD_EK_ÅMD POS(5)  PIC '(2)9',                            
      DØD_ÅM                             PIC'(6)9',                             
      T_VIRK_DATO_MND                    PIC'(4)9' INIT(0),                     
      T_VIRK_DATO_ÅMD                    PIC'(8)9' INIT(0);                     
   DCL                                                                          
      VIRK_DATO_ÅH DEF T_VIRK_DATO_ÅMD POS(1) PIC'(4)9',                        
      VIRK_DATO_Å DEF T_VIRK_DATO_ÅMD POS(3) PIC'(2)9',                         
      VIRK_DATO_M DEF T_VIRK_DATO_ÅMD POS(5) PIC'(2)9';                         
   DCL                                                                          
      MAKS_TT_FØR_1967                   PIC'(2)9' INIT(0),                     
      TT_TIL_TPK                         PIC'(4)9' INIT(0),                     
      W_TT_TIL_TPK                       PIC'(6)9' INIT(0),                     
      TT_E66_ÅM                          PIC'(6)9' INIT(0);                     
   DCL                                                                          
      F_AR2 DEF T_FNR13   POS(5)       PIC'(4)9';                               
 %PAGE;                                                                         
      FEIL_FUNNET     = '0'B;                                                   
      KEY_PEKER1      = ADDR(EPSP.STATSBORGER);                                 
      KEY_PEKER2      = ADDR(EPSP.BOSATT);                                      
      T_DØD_EK_ÅMD    = EPS.DØDSDATO_ÅMD_EK;                                    
      T_FNR           = EPS.FNR;                                                
      T_FNR13         = KONV_FNR11_FNR13(EPS.FNR);                              
      T_VIRK_DATO_ÅMD = EPS.VIRK_DATO_ÅMD;                                      
      T_VIRK_DATO_MND = (VIRK_DATO_Å * 12) + VIRK_DATO_M;                       
      TT_E66_ÅM       = (EPSP.TT_E66_Å * 100) + EPSP.TT_E66_M;                  
 %PAGE;                                /*  */                                   
                                                                                
 /* ***************************************************************** */        
 /*           F E L T K O N T R O L L E R - SØKER                     */        
 /* ***************************************************************** */        
                                                                                
              EXEC CICS HANDLE CONDITION NOTFND(NOTFND1);                       
              EXEC CICS READ DATASET ('STATTAB') RIDFLD(KEY_BIT1)               
                                               INTO(ST_RECL);                   
              GOTO STAT_UT;                                                     
          NOTFND1:                                                              
              FEIL_FUNNET        = '1'B;                                        
              EPSP.STATSBORGERNR = 24;                                          
              GOTO STAT_UT;                                                     
          STAT_UT:                                                              
              EXEC CICS HANDLE CONDITION NOTFND(NOTFND2);                       
              EXEC CICS READ DATASET ('STATTAB') RIDFLD(KEY_BIT2)               
                                               INTO(ST_RECL);                   
              GOTO BO_UT;                                                       
          NOTFND2:                                                              
              FEIL_FUNNET   = '1'B;                                             
              EPSP.BOSATTNR = 25;                                               
              GOTO BO_UT;                                                       
          BO_UT:                                                                
                                                                                
       IF ^(EPSP.FRAVIK_BOSATT = 'J' ! EPSP.FRAVIK_BOSATT = 'N'!                
            EPSP.FRAVIK_BOSATT = ' ') THEN                                      
          DO;                                                                   
             FEIL_FUNNET          = '1'B;                                       
             EPSP.FRAVIK_BOSATTNR = 119;                                        
          END;                                                                  
       IF ^(EPSP.TRYGDET_3ÅR = 'J' ! EPSP.TRYGDET_3ÅR = 'N') THEN               
          DO;                                                                   
             FEIL_FUNNET        = '1'B;                                         
             EPSP.TRYGDET_3ÅRNR = 37;                                           
          END;                                                                  
       IF ^(EPSP.FRA_TRY_3ÅR = ' ' ! EPSP.FRA_TRY_3ÅR = 'J') THEN               
          DO;                                                                   
             FEIL_FUNNET        = '1'B;                                         
             EPSP.FRA_TRY_3ÅRNR = 120;                                          
          END;                                                                  
       IF ^(EPSP.FRAVIK_10_1 = ' ' ! EPSP.FRAVIK_10_1 = 'J') THEN               
          DO;                                                                   
             FEIL_FUNNET        = '1'B;                                         
             EPSP.FRAVIK_10_1NR = 78;                                           
          END;                                                                  
       IF ^(EPSP.KONVENSJON = ' ' ! EPSP.KONVENSJON = 'J') THEN                 
          DO;                                                                   
             FEIL_FUNNET       = '1'B;                                          
             EPSP.KONVENSJONNR = 125;                                           
          END;                                                                  
 %PAGE;                                                                         
                                                                                
       IF EPSP.FRAVIK_19_3 ^= ' ' THEN                                          
          IF VERIFY(EPSP.FRAVIK_19_3,' 12345678') ^= 0 THEN                     
    /*    IF VERIFY(EPSP.FRAVIK_19_3,'0 ') ^= 0 THEN  TRUDE,0891  */            
             DO;                                                                
                FEIL_FUNNET        = '1'B;                                      
                EPSP.FRAVIK_19_3NR = 28;                                        
             END;                                                               
       IF ^(EPSP.FRAVIK_FLYKT = ' ' ! EPSP.FRAVIK_FLYKT = 'J') THEN             
          DO;                                                                   
             FEIL_FUNNET         = '1'B;                                        
             EPSP.FRAVIK_FLYKTNR = 26;                                          
          END;                                                                  
       IF ^(EPSP.OVERKOMP_UTL = 'N' ! EPSP.OVERKOMP_UTL = 'J') &                
            F_AR2 < 1937 THEN                                                   
          DO;                                                                   
             FEIL_FUNNET         = '1';                                         
             EPSP.OVERKOMP_UTLNR = 35;                                          
          END;                                                                  
       IF ^(EPSP.OVERKOMP_UTL = ' ') &                                          
            F_AR2 > 1936 THEN                                                   
          DO;                                                                   
             FEIL_FUNNET            = '1'B;                                     
             EPSP.OVERKOMP_UTLNR = 623;                                         
          END;                                                                  
       IF ^F_NUMERISK(F_FELT_PIC_CHAR3(EPSP.TT_ETTER_DØD)) THEN                 
          DO;                                                                   
             FEIL_FUNNET         = '1';                                         
             EPSP.TT_ETTER_DØDNR = 200;                                         
          END;                                                                  
       IF ^F_NUMERISK(F_FELT_PIC_CHAR2(EPSP.TT_F67)) THEN                       
          DO;                                                                   
             FEIL_FUNNET   = '1';                                               
             EPSP.TT_F67NR = 200;                                               
          END;                                                                  
       IF ^F_NUMERISK(F_FELT_PIC_CHAR2(EPSP.TT_E66_Å)) THEN                     
          DO;                                                                   
             FEIL_FUNNET     = '1';                                             
             EPSP.TT_E66_ÅNR = 200;                                             
          END;                                                                  
                                                                                
 %PAGE;                                                                         
       IF ^F_NUMERISK(F_FELT_PIC_CHAR2(EPSP.TT_E66_M)) THEN                     
          DO;                                                                   
             FEIL_FUNNET     = '1';                                             
             EPSP.TT_E66_MNR = 200;                                             
          END;                                                                  
       IF ^F_NUMERISK(F_FELT_PIC_CHAR2(EPSP.TT_FRAMT_10_1)) THEN                
          DO;                                                                   
             FEIL_FUNNET          = '1';                                        
             EPSP.TT_FRAMT_10_1NR = 200;                                        
          END;                                                                  
       IF ^(EPSP.TRYGDET_DØD = 'J' ! EPSP.TRYGDET_DØD = 'N') THEN               
          DO;                                                                   
             FEIL_FUNNET        = '1';                                          
             EPSP.TRYGDET_DØDNR = 121;                                          
          END;                                                                  
       IF ^F_NUMERISK(F_FELT_PIC_CHAR2(EPSP.TT_VENT_UTL)) THEN                  
          DO;                                                                   
             FEIL_FUNNET        = '1';                                          
             EPSP.TT_VENT_UTLNR = 200;                                          
          END;                                                                  
       IF ^(EPSP.IKKE_GP = 'J' ! EPSP.IKKE_GP = ' ') THEN                       
          DO;              /*RETTET TIL'J' FRA 'N' SE BRUKERB. */               
             FEIL_FUNNET    = '1';                                              
             EPSP.IKKE_GPNR = 36;                                               
          END;                                                                  
                                                                                
 %PAGE;                                /*    */                                 
 /* ***************************************************************** */        
 /*              K R Y S S K O N T R O L L E R - SØKER                */        
 /* ***************************************************************** */        
                                                                                
 IF ^FEIL_FUNNET THEN                                                           
    DO;                                                                         
       IF EPSP.BOSATT = 0 & EPSP.FRAVIK_BOSATT = 'J' THEN                       
          DO;                                                                   
             FEIL_FUNNET          = '1'B;                                       
             EPSP.BOSATTNR        = 110;                                        
             EPSP.FRAVIK_BOSATTNR = 999;                                        
          END;                                                                  
       IF EPSP.FRAVIK_BOSATT = 'N' & (EPSP.TT_F67 > 0 !                         
          EPSP.TT_E66_Å > 0 ! EPSP.TT_E66_M > 0) THEN                           
          DO;                                                                   
             FEIL_FUNNET          = '1'B;                                       
             EPSP.FRAVIK_BOSATTNR = 143;                                        
             EPSP.TT_F67NR        = 999;                                        
             EPSP.TT_E66_ÅNR      = 999;                                        
             EPSP.TT_E66_MNR      = 999;                                        
          END;                                                                  
                                                                                
       IF EPSP.FRAVIK_10_1 = ' ' & EPSP.TT_FRAMT_10_1 > 0 THEN                  
          DO;                                                                   
             FEIL_FUNNET           = '1'B;                                      
             EPSP.FRAVIK_10_1NR    = 192;                                       
             EPSP.TT_FRAMT_10_1NR  = 999;                                       
          END;                                                                  
       IF EPSP.FRAVIK_10_1 = 'J' & EPSP.KONVENSJON = 'J' THEN                   
          DO;                                                                   
             FEIL_FUNNET           = '1'B;                                      
             EPSP.FRAVIK_10_1NR    = 155;                                       
             EPSP.KONVENSJONNR  = 999;                                          
          END;                                                                  
      IF  EPS.YSKADE_TILLEGG  ^= 'J'    THEN     /* TRUDE   */                  
       DO;                                                                      
       IF EPSP.BOSATT > 0 & (EPSP.FRAVIK_BOSATT = ' ' &                         
          EPSP.KONVENSJON   = ' ') THEN                                         
          DO;                                                                   
             FEIL_FUNNET           = '1'B;                                      
             EPSP.FRAVIK_BOSATTNR    = 128;                                     
             EPSP.BOSATTNR    = 999;                                            
             EPSP.KONVENSJONNR  = 999;                                          
          END;                                                                  
       IF EPSP.BOSATT > 0 & (EPSP.FRAVIK_BOSATT = 'N' &                         
          EPSP.KONVENSJON   = ' ') THEN                                         
          DO;                                                                   
             FEIL_FUNNET           = '1'B;                                      
             EPSP.FRAVIK_BOSATTNR    = 128;                                     
             EPSP.BOSATTNR    = 999;                                            
             EPSP.KONVENSJONNR  = 999;                                          
          END;                                                                  
       END;                                    /* END YSKADE_TILLEGG  */        
 %PAGE;   /*  */                                                                
 /* ***************************************************************** */        
 /* REGNER UT ÅR OG MND VEDKOMMENDE FYLLER 67 ÅR (ÅÅMM)               */        
 /*(SIFFER 7-9 ANGIR ÅRHUNDRE:1800-TALLET 500-749,1900-TALLET 000-499)*/        
 /* ***************************************************************** */        
                                        /* 2000-3 */                            
       FYLT_SEKSTISJU = (FNR13.ÅR + 67) * 100 + FNR13.MN;                       
 /* ***************************************************************** */        
 /* REGNER UT ÅR OG MND VEDKOMMENDE FYLLER 70 ÅR (ÅÅMM)  (SE OVENFOR) */        
 /* ***************************************************************** */        
                                                                                
                                                                                
       FYLT_SYTTI = (FNR13.ÅR + 70) * 100 + FNR13.MN;                           
                                                                                
 /* ***************************************************************** */        
                                                                                
 /*  KONTROLL AV TT ETTER DØDSTIDSPUNKT                               */        
 /* ***************************************************************** */        
                                                                                
       IF EPSP.TT_ETTER_DØD ^= 0 THEN                                           
          DO;                                                                   
             MAKS_TT_ETTER_DØD = (SEKSTI_ÅR * 12 + SEKSTI_MND)-                 
                                (DØD_Å * 12 + DØD_M);    /* 2000-3 */           
             IF EPSP.TT_ETTER_DØD > MAKS_TT_ETTER_DØD THEN                      
                DO;                                                             
                   FEIL_FUNNET         = '1'B;                                  
                   EPSP.TT_ETTER_DØDNR = 79;                                    
                END;                                                            
          END;                                                                  
 %PAGE;                                /*   */                                  
 /* ***************************************************************** */        
 /* KONTROLLERER SØKERENS TRYGDETID, OG LEGGER 1 ÅR TIL TT_E66_Å HVIS */        
 /* TT_E66_M > 0                                                      */        
 /* ***************************************************************** */        
                                                                                
 /*** TRYGDETIDEN MÅ ALLTID OPPGIS NÅR DET ER SPESIELLE OPPLYSNINGER*/          
 /*** UNTATT NÅR YSKADE_TILLEGG = J              TRUDE 19.1.90      */          
                                                                                
    IF  EPS.YSKADE_TILLEGG  ^= 'J'    THEN     /* TRUDE   */                    
      DO;                                                                       
       IF EPSP.TT_F67 = 0 & EPSP.TT_E66_M = 0 &                                 
          EPSP.TT_E66_Å = 0 &                                                   
                                                                                
 /* TILLEGG 31.8.84  HL                                        */               
                                                                                
          EPSP.TT_F67_EK = 0 & EPSP.TT_E66_M_EK = 0 &                           
          EPSP.TT_E66_Å_EK = 0    THEN                                          
                                                                                
 /* HIT  HL                                                    */               
                                                                                
                                                                                
                                                                                
          DO;                                                                   
             FEIL_FUNNET = '1'B;                                                
             EPSP.TT_F67NR = 195;                                               
             EPSP.TT_E66_MNR = 999;                                             
             EPSP.TT_E66_ÅNR = 999;                                             
          END;                                                                  
      END;                              /* END YSKADE_TILLEGG. TRUDE */         
                                                                                
       IF EPSP.TT_E66_M > 0 THEN                                                
          TT = EPSP.TT_F67 + (EPSP.TT_E66_Å + 1);                               
       ELSE                                                                     
          TT = EPSP.TT_F67 + EPSP.TT_E66_Å;                                     
                                                                                
  /*   IF EPSP.TT_E66_M >= 12 THEN   */                                         
       IF EPSP.TT_E66_M >  12 THEN                                              
          DO;                                                                   
             FEIL_FUNNET     = '1'B;                                            
             EPSP.TT_E66_MNR = 112;                                             
          END;                                                                  
   CALL TT_UP_EP(EPS.FNR,EPS.VIRK_DATO_ÅMD,MAKS_TT_FØR_1967,TT_TIL_TPK);        
       IF EPSP.TT_F67 > MAKS_TT_FØR_1967 THEN                                   
          DO;                                                                   
             FEIL_FUNNET     = '1'B;                                            
             EPSP.TT_F67NR   = 31;                                              
          END;                                                                  
                                                                                
       IF TT_E66_ÅM > TT_TIL_TPK THEN                                           
          DO;                                                                   
             FEIL_FUNNET     = '1'B;                                            
             EPSP.TT_E66_MNR = 112;                                             
             EPSP.TT_E66_ÅNR = 999;                                             
          END;                                                                  
       IF EPS.NORSK_BOSATT_EK = 'J'  !                                          
          EPS.NORSK_BOSATT_EK = ' ' THEN                                        
          DO;  /* AVDØDE HAR IKKE SPESIELLE OPPLYSNINGER */                     
               /* KONTROLLENE HER TILSVARER DE UNDER KRYSSKONTROLL */           
               /* SØKER OG AVDØDE                                  */           
            IF EPSP.TRYGDET_3ÅR = 'J' & EPSP.TRYGDET_DØD = 'N' THEN             
              DO;                                                               
                FEIL_FUNNET = '1'B;                                             
                EPSP.TRYGDET_3ÅRNR    = 243;                                    
                EPSP.TRYGDET_DØDNR    = 999;                                    
              END;                                                              
            ELSE                                                                
              DO;                                                               
                IF EPSP.TRYGDET_3ÅR = 'J' THEN                                  
                  DO;                                                           
                    IF EPSP.FRA_TRY_3ÅR = 'J' THEN                              
                      DO;                                                       
                         FEIL_FUNNET = '1'B;                                    
                         EPSP.TRYGDET_3ÅRNR    = 103;                           
                         EPSP.FRA_TRY_3ÅRNR    = 999;                           
                      END;                                                      
                  END;                                                          
                ELSE                                                            
                  /* TRYGDET = 'N' */                                           
                  IF EPSP.FRA_TRY_3ÅR = 'J' THEN                                
                    DO;                                                         
                      FEIL_FUNNET = '1'B;                                       
                      EPSP.FRA_TRY_3ÅRNR = 244;                                 
                    END;                                                        
              END;                                                              
            IF ^FEIL_FUNNET THEN                                                
              DO;                                                               
                IF EPSP.KONVENSJON = 'J' THEN                                   
                  DO;                                                           
                    IF EPSP.BOSATT = 0 THEN                                     
                      DO;                                                       
                        FEIL_FUNNET = '1'B;                                     
                        EPSP.BOSATTNR = 104;                                    
                        EPSP.TRYGDET_3ÅRNR = 999;                               
                        EPSP.KONVENSJONNR = 999;                                
                      END;                                                      
                    IF EPSP.FRAVIK_BOSATT = 'J' THEN                            
                      DO;                                                       
                        FEIL_FUNNET = '1'B;                                     
                        EPSP.KONVENSJONNR = 189;                                
                        EPSP.FRAVIK_BOSATTNR = 999;                             
                      END;                                                      
                    IF EPSP.FRAVIK_BOSATT = 'N' THEN                            
                      DO;                                                       
                        FEIL_FUNNET = '1'B;                                     
                        EPSP.FRAVIK_BOSATTNR = 105;                             
                        EPSP.KONVENSJONNR = 999;                                
                      END;                                                      
                  END;    /* KONVENSJON = J  */                                 
                IF EPSP.BOSATT = 0 & EPSP.FRAVIK_10_1 = 'J' THEN                
                  DO;                                                           
                    FEIL_FUNNET = '1'B;                                         
                    EPSP.BOSATTNR = 141;                                        
                    EPSP.FRAVIK_10_1NR = 999;                                   
                  END;                                                          
              END;                                                              
          END;   /* NORSK_BOSATT_EK  */                                         
                                                                                
    END;  /*FEIL_FUNNET */                                                      
  END KONTROLL_EP_SPES;                                                         
 %PAGE;                                                                         
                                                                                
 KONTROLL_EP_SPES_EK:                                                           
   PROC(FEIL_FUNNET);                                                           
 /* ***************************************************************** */        
 /*           F E L T K O N T R O L L E R  -  AVDØDE                  */        
 /* ***************************************************************** */        
 %SKIP(2);                                                                      
                                                                                
  DCL FEIL_FUNNET BIT(1),                                                       
      TT_EK       PIC'99';                                                      
   DCL                                                                          
      FNR13_AVD                        PIC'(13)9';                              
   DCL                                                                          
      F_AAR DEF FNR13_AVD  POS(5)       PIC'(4)9';                              
   DCL                                                                          
      KEY_BIT3                   BIT(32) BASED (KEY_PEKER3),                    
      KEY_BIT4                   BIT(32) BASED (KEY_PEKER4),                    
      KEY_PEKER3                 POINTER,                                       
      KEY_PEKER4                 POINTER,                                       
      ST_RECL                    CHAR (35);                                     
   DCL                                                                          
      MAKS_TT_FØR_1967                    PIC'(2)9' INIT(0),                    
      TT_TIL_TPK                         PIC'(4)9' INIT(0),                     
      TT_E66_ÅM                          PIC'(6)9' INIT(0);                     
 %SKIP(2);                                                                      
                                                                                
      FNR13_AVD       = KONV_FNR11_FNR13(EPS.FNR_EK);                           
      KEY_PEKER3      = ADDR(EPSP.STATSBORGER_EK);                              
      KEY_PEKER4      = ADDR(EPSP.BOSATT_EK);                                   
                                                                                
              EXEC CICS HANDLE CONDITION NOTFND(NOTFND3);                       
              EXEC CICS READ DATASET ('STATTAB') RIDFLD(KEY_BIT3)               
                                               INTO(ST_RECL);                   
              GOTO STAT_UT;                                                     
          NOTFND3:                                                              
              FEIL_FUNNET           = '1'B;                                     
              EPSP.STATSBORGER_EKNR = 24;                                       
              GOTO STAT_UT;                                                     
          STAT_UT:                                                              
              EXEC CICS HANDLE CONDITION NOTFND(NOTFND4);                       
              EXEC CICS READ DATASET ('STATTAB') RIDFLD(KEY_BIT4)               
                                               INTO(ST_RECL);                   
              GOTO BO_UT;                                                       
          NOTFND4:                                                              
              FEIL_FUNNET      = '1'B;                                          
              EPSP.BOSATT_EKNR = 25;                                            
              GOTO BO_UT;                                                       
          BO_UT:                                                                
                                                                                
  IF ^(EPSP.TRYGDET_3ÅR_EK = 'J' ! EPSP.TRYGDET_3ÅR_EK = 'N') THEN              
     DO;                                                                        
        FEIL_FUNNET           = '1'B;                                           
        EPSP.TRYGDET_3ÅR_EKNR = 37;                                             
     END;                                                                       
  IF ^(EPSP.FRAVIK_FLYKT_EK = ' ' ! EPSP.FRAVIK_FLYKT_EK = 'J') THEN            
     DO;                                                                        
        FEIL_FUNNET            = '1'B;                                          
        EPSP.FRAVIK_FLYKT_EKNR = 26;                                            
     END;                                                                       
  IF ^(EPSP.OVERKOMP_UTL_EK = 'N' ! EPSP.OVERKOMP_UTL_EK = 'J') &               
       F_AAR < 1937 THEN                                                        
     DO;                                                                        
        FEIL_FUNNET            = '1'B;                                          
        EPSP.OVERKOMP_UTL_EKNR = 35;                                            
     END;                                                                       
  IF ^(EPSP.OVERKOMP_UTL_EK = ' ') &                                            
       F_AAR > 1936 THEN                                                        
     DO;                                                                        
        FEIL_FUNNET            = '1'B;                                          
        EPSP.OVERKOMP_UTL_EKNR = 623;                                           
     END;                                                                       
 %PAGE;                                                                         
  IF ^(EPSP.TRYGDET_DØD_EK = 'J' ! EPSP.TRYGDET_DØD_EK = 'N') THEN              
     DO;                                                                        
        FEIL_FUNNET           = '1'B;                                           
        EPSP.TRYGDET_DØD_EKNR = 121;                                            
     END;                                                                       
  IF ^F_NUMERISK(F_FELT_PIC_CHAR2(EPSP.TT_F67_EK)) THEN                         
     DO;                                                                        
        FEIL_FUNNET      = '1'B;                                                
        EPSP.TT_F67_EKNR = 200;                                                 
     END;                                                                       
  IF ^F_NUMERISK(F_FELT_PIC_CHAR2(EPSP.TT_E66_Å_EK)) THEN                       
     DO;                                                                        
        FEIL_FUNNET      = '1'B;                                                
        EPSP.TT_F67_EKNR = 200;                                                 
     END;                                                                       
  IF ^F_NUMERISK(F_FELT_PIC_CHAR2(EPSP.TT_E66_M_EK)) THEN                       
     DO;                                                                        
        FEIL_FUNNET      = '1'B;                                                
        EPSP.TT_F67_EKNR = 200;                                                 
     END;                                                                       
  IF ^F_NUMERISK(F_FELT_PIC_CHAR2(EPSP.TT_FRAMT_10_1_EK)) THEN                  
     DO;                                                                        
        FEIL_FUNNET             = '1'B;                                         
        EPSP.TT_FRAMT_10_1_EKNR = 200;                                          
     END;                                                                       
                                                                                
 %PAGE;        /*  */                                                           
 /* ***************************************************************** */        
 /*              K R Y S S K O N T R O L L E R - AVDØDE               */        
 /* ***************************************************************** */        
                                                                                
  IF ^FEIL_FUNNET THEN                                                          
     DO;                                                                        
        IF EPSP.TRYGDET_3ÅR_EK = 'J' & EPSP.TRYGDET_DØD_EK = 'N' THEN           
           DO;                                                                  
              FEIL_FUNNET            = '1'B;                                    
              EPSP.TRYGDET_3ÅR_EKNR  = 148;                                     
              EPSP.TRYGDET_DØD_EKNR  = 999;                                     
           END;                                                                 
   /*   IF EPSP.BOSATT_EK ^= 0 & EPSP.FRAVIK_19_3 = '0' THEN                    
           IF EPSP.TT_F67_EK > 0 THEN                                           
              DO;                                                               
                 FEIL_FUNNET        = '1'B;                                     
                 EPSP.BOSATT_EKNR   = 158;                                      
                 EPSP.FRAVIK_19_3NR = 999;                                      
              END;   */                                                         
                                                                                
        IF EPSP.BOSATT_EK = 0  & EPSP.FRAVIK_19_3 ^= ' ' THEN                   
              DO;                                                               
                 FEIL_FUNNET        = '1'B;                                     
                 EPSP.BOSATT_EKNR   = 158;                                      
                 EPSP.FRAVIK_19_3NR = 999;                                      
              END;                                                              
                                                                                
 /* ***************************************************************** */        
 /* KONTROLLERER EKTEF.S  TRYGDETID, OG LEGGER 1 ÅR TIL TT_E66_Å HVIS */        
 /* TT_E66_M > 0                                                      */        
 /* ***************************************************************** */        
                                                                                
   /*  IF EPSP.TT_E66_M_EK >= 12 THEN   */                                      
       IF EPSP.TT_E66_M_EK >  12 THEN                                           
          DO;                                                                   
             FEIL_FUNNET        = '1'B;                                         
             EPSP.TT_E66_M_EKNR = 112;                                          
          END;                                                                  
                                                                                
       CALL TT_UP_EP(EPS.FNR_EK,EPS.VIRK_DATO_ÅMD,    /* 2000-3 */              
                                           MAKS_TT_FØR_1967,TT_TIL_TPK);        
       IF EPSP.TT_F67_EK > MAKS_TT_FØR_1967 THEN                                
          DO;                                                                   
             FEIL_FUNNET        = '1'B;                                         
             EPSP.TT_F67_EKNR   = 32;                                           
          END;                                                                  
                                                                                
       TT_E66_ÅM          = (EPSP.TT_E66_Å_EK * 100) + EPSP.TT_E66_M_EK;        
                                                                                
       IF TT_E66_ÅM > TT_TIL_TPK THEN                                           
          DO;                                                                   
             FEIL_FUNNET        = '1'B;                                         
             EPSP.TT_E66_Å_EKNR = 112;                                          
             EPSP.TT_E66_M_EKNR = 999;                                          
          END;                                                                  
                                                                                
        IF EPSP.TT_E66_M_EK > 0 THEN                                            
           TT_EK = EPSP.TT_F67_EK + (EPSP.TT_E66_Å_EK + 1);                     
        ELSE                                                                    
           TT_EK = EPSP.TT_F67_EK + EPSP.TT_E66_Å_EK;                           
     END;                                                                       
                                                                                
 %PAGE;    /*  */                                                               
 /* ***************************************************************** */        
 /* KRYSSKONTROLLER HVOR OPPL. OM BÅDE SØKER OG AVDØDE KAN INNGÅ..    */        
 /* ***************************************************************** */        
                                                                                
 IF ^FEIL_FUNNET THEN                                                           
    DO;                                                                         
       IF EPSP.TRYGDET_3ÅR = 'J' & EPSP.TRYGDET_DØD = 'N' THEN                  
          DO;                                                                   
             FEIL_FUNNET = '1'B;                                                
             EPSP.TRYGDET_3ÅRNR    = 243;                                       
             EPSP.TRYGDET_DØDNR    = 999;                                       
          END;                                                                  
       ELSE                                                                     
          DO;                                                                   
             IF EPSP.TRYGDET_3ÅR = 'J' THEN                                     
                DO;                                                             
                   IF EPSP.FRA_TRY_3ÅR = 'J' THEN                               
                      DO;                                                       
                         FEIL_FUNNET = '1'B;                                    
                         EPSP.TRYGDET_3ÅRNR    = 103;                           
                         EPSP.FRA_TRY_3ÅRNR    = 999;                           
                      END;                                                      
                END;                                                            
             ELSE                                                               
                DO;   /* TRYGDET = 'N' */                                       
                   IF EPSP.FRA_TRY_3ÅR = 'J' THEN                               
                      DO;                                                       
                         IF EPSP.TRYGDET_3ÅR_EK = 'J' THEN                      
                           DO;                                                  
                            FEIL_FUNNET = '1'B;                                 
                            EPSP.FRA_TRY_3ÅRNR = 244;                           
                            EPSP.TRYGDET_3ÅR_EKNR =999;                         
                           END;                                                 
                         ELSE                                                   
                            IF EPSP.KONVENSJON = 'J' THEN                       
                             DO;                                                
                              FEIL_FUNNET = '1'B;                               
                              EPSP.FRA_TRY_3ÅRNR = 105;                         
                              EPSP.KONVENSJONNR = 999;                          
                             END;                                               
                      END;                                                      
                   ELSE                                                         
                    IF  EPS.YSKADE_TILLEGG  ^= 'J'    THEN  /*TRUDE  */         
                     DO;                                                        
                      IF EPSP.TRYGDET_3ÅR_EK = 'N' &                            
                        EPSP.KONVENSJON = ' ' THEN                              
                        DO;                                                     
                           FEIL_FUNNET = '1'B;                                  
                           EPSP.TRYGDET_3ÅRNR = 147;                            
                           EPSP.FRA_TRY_3ÅRNR = 999;                            
                           EPSP.TRYGDET_3ÅR_EKNR = 999;                         
                           EPSP.KONVENSJONNR = 999;                             
                        END;                                                    
                     END;                              /*END Y-TILL.TS*/        
                END;                                                            
          IF ^FEIL_FUNNET THEN                                                  
             DO;  /* HIT KOMMER ALLE TRANSER SOM HAR PASSERT */                 
                  /* KRYSSKONTROLL SPES.SØKER OG AVDØDE      */                 
               IF EPSP.TRYGDET_3ÅR = 'J' THEN                                   
                 DO;                                                            
                   IF EPSP.KONVENSJON = 'J' THEN                                
                     DO;                                                        
                       IF EPSP.BOSATT = 0 THEN                                  
                         DO;                                                    
                           FEIL_FUNNET = '1'B;                                  
                           EPSP.BOSATTNR = 240;                                 
                           EPSP.TRYGDET_3ÅRNR = 999;                            
                           EPSP.KONVENSJONNR = 999;                             
                         END;                                                   
                       IF EPSP.FRAVIK_BOSATT = 'J' THEN                         
                         DO;                                                    
                           FEIL_FUNNET = '1'B;                                  
                           EPSP.KONVENSJONNR = 189;                             
                           EPSP.FRAVIK_BOSATTNR = 999;                          
                         END;                                                   
                       IF EPSP.FRAVIK_BOSATT = 'N' THEN                         
                         DO;                                                    
                           FEIL_FUNNET = '1'B;                                  
                           EPSP.FRAVIK_BOSATTNR = 105;                          
                           EPSP.KONVENSJONNR = 999;                             
                         END;                                                   
                     END;    /* KONVENSJON = J  */                              
                   IF EPSP.BOSATT = 0 & EPSP.FRAVIK_10_1 = 'J' THEN             
                     DO;                                                        
                       FEIL_FUNNET = '1'B;                                      
                       EPSP.BOSATTNR = 141;                                     
                       EPSP.FRAVIK_10_1NR = 999;                                
                     END;                                                       
                 END;  /* TRYGDET_3ÅR = J */                                    
               ELSE                                                             
                 DO;   /* TRYGDET_3ÅR = N */                                    
                   IF EPSP.FRA_TRY_3ÅR  = ' ' THEN                              
                     DO;                                                        
                       IF EPSP.TRYGDET_3ÅR_EK = 'J' THEN                        
                         DO;                                                    
                           IF EPSP.BOSATT = 0 &                                 
                              EPSP.FRAVIK_10_1 = 'J' THEN                       
                             DO;                                                
                               FEIL_FUNNET = '1'B;                              
                               EPSP.BOSATTNR = 141;                             
                               EPSP.FRAVIK_10_1NR = 999;                        
                             END;                                               
                          IF EPSP.KONVENSJON = 'J' &                            
                             EPSP.BOSATT = 0 THEN                               
                             DO;                                                
                               FEIL_FUNNET = '1'B;                              
                               EPSP.BOSATTNR = 240;                             
                               EPSP.TRYGDET_3ÅRNR = 999;                        
                               EPSP.KONVENSJONNR = 999;                         
                             END;                                               
                          IF EPSP.KONVENSJON = 'J' &                            
                             EPSP.FRAVIK_BOSATT = 'J' THEN                      
                             DO;                                                
                               FEIL_FUNNET = '1'B;                              
                               EPSP.KONVENSJONNR = 189;                         
                               EPSP.FRAVIK_BOSATTNR = 999;                      
                             END;                                               
                          IF EPSP.KONVENSJON = 'J' &                            
                             EPSP.FRAVIK_BOSATT = 'N' THEN                      
                             DO;                                                
                               FEIL_FUNNET = '1'B;                              
                               EPSP.FRAVIK_BOSATTNR = 105;                      
                               EPSP.KONVENSJONNR = 999;                         
                             END;                                               
                         END;  /* TRYGDET_3ÅR_EK */                             
                       ELSE                                                     
                         DO;                                                    
                          IF EPSP.KONVENSJON = 'J' &                            
                             EPSP.FRAVIK_BOSATT = 'J' THEN                      
                             DO;                                                
                               FEIL_FUNNET = '1'B;                              
                               EPSP.KONVENSJONNR = 189;                         
                               EPSP.FRAVIK_BOSATTNR = 999;                      
                             END;                                               
                          IF EPSP.KONVENSJON = 'J' &                            
                             EPSP.FRAVIK_BOSATT = 'N' THEN                      
                             DO;                                                
                               FEIL_FUNNET = '1'B;                              
                               EPSP.FRAVIK_BOSATTNR = 105;                      
                               EPSP.KONVENSJONNR = 999;                         
                             END;                                               
                         END;                                                   
                     END;   /* FRA_TRY_3ÅR = ' ' */                             
                 END;       /* TRYGDET_3ÅR = 'N' */                             
      /* PENSJON UTLAND. TAR BORT TESTEN NEDENFOR.TRUDE 300490 */               
      /*  ***  IF EPSP.IKKE_GP ^= ' ' & (EPSP.TT_F67 > 0 !                      
                  EPSP.TT_E66_Å > 0 ! EPSP.TT_E66_M > 0 !                       
                  EPSP.TT_F67_EK > 0 ! EPSP.TT_E66_Å_EK > 0 !                   
                  EPSP.TT_E66_M_EK > 0) THEN                                    
                  DO;                                                           
                    FEIL_FUNNET    = '1'B;                                      
                    EPSP.IKKE_GPNR = 223;                                       
                  END;    ****   *****     */                                   
               IF (EPSP.TT_FRAMT_10_1 > 0 ! EPSP.TT_FRAMT_10_1_EK > 0) &        
                   EPSP.TT_ETTER_DØD > 0 THEN                                   
                  DO;                                                           
                    FEIL_FUNNET             = '1'B;                             
                    EPSP.TT_FRAMT_10_1NR    = 190;                              
                    EPSP.TT_FRAMT_10_1_EKNR = 999;                              
                    EPSP.TT_ETTER_DØDNR     = 999;                              
                  END;                                                          
             END;     /* FEIL_FUNNET  */                                        
          END;                                                                  
    END;           /* FEIL_FUNNET  */                                           
 %PAGE;   /*  */                                                                
 /* ***************************************************************** */        
 /* KRYSSKONTROLLER HVOR FRAVIK_19_3 INNGÅR I SAMTLIGE                */        
 /* ***************************************************************** */        
                                                                                
  IF ^FEIL_FUNNET THEN                                                          
     DO;                                                                        
        IF EPSP.FRAVIK_19_3 ^= ' ' & EPSP.BOSATT = 0 THEN                       
           DO;                                                                  
              FEIL_FUNNET           = '1'B;                                     
              EPSP.FRAVIK_19_3NR    = 219;                                      
              EPSP.BOSATTNR         = 999;                                      
           END;                                                                 
        IF EPSP.FRAVIK_19_3 = '0' & EPSP.TT_F67 > 0 THEN                        
           DO;                                                                  
              FEIL_FUNNET           = '1'B;                                     
              EPSP.FRAVIK_19_3NR    = 83;                                       
              EPSP.TT_F67NR         = 999;                                      
           END;                                                                 
     END;                                                                       
  END KONTROLL_EP_SPES_EK;                                                      
